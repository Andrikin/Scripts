#!/usr/bin/env bash
# Script que utiliza os pacotes youtube-dl e ffmpeg para baixar audio do YouTube e converter esse nome_arquivo para o formato FLAC

erro_abortar(){
   notify-send -u critical --expire-time=3250 "YouTube-Flac" "Áudio: $nome_final - Falhou..."
}

sucesso(){
   notify-send --expire-time=3250 "YouTube-Flac" "Áudio: $nome_arquivo - Concluído com Sucesso!"
}

trap erro_abortar EXIT

set -e

link="$(zenity --entry --title="YouTube-FLAC" --text="Para download e conversão de áudio do YouTube, insira o link")"

nome_arquivo="$(youtube-dl --get-title "$link")"

if [[ $link == *youtu.be/* ]];then
	tag_youtube="${link##*/}"
elif [[ $link == *youtube.com/watch?v=* ]];then
	tag_youtube="${link#*=}"
fi

youtube-dl -q -f bestaudio -o "$HOME/Música/AudiosYouTube/%(id)s.%(ext)s" "$link"

nome_atual_arquivo=$(ls "$HOME/Música/AudiosYouTube" | grep "$tag_youtube")

ffmpeg -i "$HOME/Música/AudiosYouTube/$nome_atual_arquivo" "$HOME/Música/AudiosYouTube/$nome_arquivo.ogg" -loglevel quiet

if [[ -e $HOME/Música/AudiosYouTube/$nome_atual_arquivo ]]; then
   rm "$HOME/Música/AudiosYouTube/$nome_atual_arquivo"
fi

trap sucesso EXIT
